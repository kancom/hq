################################################################################
#                     test task for HQ
################################################################################
﻿Market Clients




1. Терминология        1
Common        1
Development        1
2. Рекомендации к написанию клиентов        3
3. Код        5
4. Тестовое задание        6






1. Терминология
Common


Currency (Валюта) — валюта, тип денег. Например, доллар США или биткоин.


Currency pair (Валютная пара) — пара валют, которая означает отношение одной валюты к другой. Как и в простом математическом отношении порядок имеет значение. Например, доллар США к биткоину.


Symbol (Символ) — символьное обозначение валюты или валютной пары. Например, USD или USDBTC.


Platform (Платформа) — система(, которая является основой для разной деятельности). Программная платформа — это программная система, обычно со своим API.


Exchange (Биржа) — учреждение для заключения финансовых и коммерческих сделок. Часто биржа реализуется как программная платформа, доступная через интернет в любой точке мира.
Development


Connector (Коннектор) — в широком смысле это класс или группа классов, через которые мы подключаемся к API отдельных платформ, чтобы выполнить какое-либо действие. В нашем случае такие коннекторы разбиваются на клиенты, которые приводят REST и WS-интерфейсы отдельных платформ к единому интерфейсу на уровне кода, то есть реализованному в классе, а также на коннекторы в узком смысле, которые используют клиенты и реализуют более сложную логику использования API платформ, которая включает реконнекты, обработку ошибок, фиксирование скачанных и пропущенных данных, которые нужно скачать позже и так далее.


Client (Клиент) — класс, через который мы в программе обращаемся к другим внешним API: REST и WS API бирж, например. Другими словами, он преобразует внешний общий API в API на уровне классов конкретного языка программирования. Обычно, через одинаковый такой программный интерфейс можно обращаться к разным платформам, собственные API которых отличаются.
________________


2. Рекомендации к написанию клиентов


Сейчас сделаны только трейды и только для трех платформ: Binance, Bitfinex и BitMEX (базовый исходный код), поэтому очевидно, что код будет меняться, и его не стоит воспринимать как нечто завершенное или, более того, догму. Остальные методы и клиенты для других платформ можно и нужно делать по образцу. Чтобы быстрее разобраться с кодом, ниже приведены некоторые принципы и общая схема по которым он был написан.


Чтобы разобраться в коде быстрее всего рекомендуется идти от файлов binance.py, bitfinex.py, bitmex.py, то есть от примеров конкретных реализаций к основанию, к базовым классам. После этого можно пойти обратно: от базовых классов к конкретным реализациям. Результат работы по добавлению новых клиентов и реализации новых функций будет похож на код из этих трех файлов: binance.py, bitfinex.py, bitmex.py.


Библиотека клиентов для разных платформ бирж основана на том положении, что все биржи реализуют в большинстве одну и ту же функциональность: все дают список ордеров, трейдов и прочего. Но они делают это по-разному. Основное различие заключается в формате данных. Поэтому и в коде за основу был взят конвертер, которые преобразует формат каждой платформы в наш общий для всех формат. 


Отсюда вытекает основная цель библиотеки: приведение всех (в идеале всех) бирж к единому формату, или предоставление доступа ко всем биржам через единый интерфейс. Наша библиотека должна рассматриваться как единая точка доступа к вообще всем биржам.


В основе формата лежат термины и то, что они означают. У каждой биржи есть различия в терминологии. Наша цель устранить эти различия, выработав единую наиболее точную систему терминов. Это самое важное, поэтому и в документе это находится в самом начале.


Минимум, что предоставляет библиотека — это интерфейс, пустой базовый класс с заданными сигнатурами функций: их названиями и параметрами. 


Второе: это конвертер наших имен в имена конкретной платформы. Для многих бирж будет достаточно настроить словари соответствия этих имен, чтобы все заработало.


Для остальных же придется вносить определенные корректировки в конвертер для преобразования тех или иных значений и прочего. Это предусмотрено разбиением процесса парсинга и преобразования на отдельные методы-шаги, каждый из которых можно будет без труда переопределить в подклассе. Таким образом, в самом клиенте изменения вносятся только в исключительных случаях. Вероятно, будут попадаться такие API платформ, которые будут требовать значительных переделок и в базовых классах библиотеки.


Примечание.


Код библиотеки не идеален и находится в процессе развития. Недостатки основной библиотеки являются недостатками, то есть их нужно исправлять, а не повторять или брать за образец для своего кода.




________________


3. Код


Чтобы можно было легко ориентироваться в коде, мы должны быть всегда уверены, что одни и те же слова и имена переменных, классов и методов означают одни те же понятия. Другими словами, имя должно точно соответствовать своему значению, форма — содержанию и наоборот.


Например, если мы параметры запроса (params) преобразуем в параметры платформы, то мы уже не можем использовать прежнее название params, а должны назвать новую переменную platform_params. Это не только делает код понятным, но и позволяет избежать многих ошибок по недоразумению, а также ускоряет разработку, так как больше не нужно отслеживать происхождение значения той или иной переменной, если нам нужно сделать изменения в малознакомом или подзабытом старом коде.


________________


4. Тестовое задание


Необходимо разобраться в исходных базовых классах и, используя их, сделать следующее:


1. Написать класс клиента (вместе с конвертером) для REST API v1 биржи Okex, который реализует 2 функции:
   * Получение трейдов (trades) (метод fetch_trades_history)
   * Получение свечей (kline/candlestick) (метод fetch_candles)
1. Написать класс клиента (вместе с конвертером) для Websocket API v1 биржи Okex, который реализует 2 функции:
   * Получение трейдов (trades)
   * Получение свечей (kline/candlestick)


Исходный код базовых классов - https://drive.google.com/file/d/1LGvnjVycOB8Mu2Wxc9ov5fEtFpe2eleS/view 


Документация API биржи Okex - https://github.com/okcoin-okex/API-docs-OKEx.com/tree/master/API-For-Spot-EN


Для проверки работоспособности написанного кода можно использовать файл “run_demo.py” в корне проекта.
################################################################################

# hqlib
Common library for HyperQuant projects on Python

## Install

    pipenv install

## Run demo code

    pipenv run python run_demo.py
    

